'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _immutable = require('immutable');

var getEntityRanges = function getEntityRanges(text, charMetaList) {
    var charEntity = null;
    var prevCharEntity = null;
    var ranges = [];
    var rangeStart = 0;
    for (var i = 0, len = text.length; i < len; i++) {
        prevCharEntity = charEntity;
        var meta = charMetaList.get(i);
        charEntity = meta ? meta.getEntity() : null;
        if (i > 0 && charEntity !== prevCharEntity) {
            ranges.push([prevCharEntity, getStyleRange(text.slice(rangeStart, i), charMetaList.slice(rangeStart, i))]);
            rangeStart = i;
        }
    }
    ranges.push([charEntity, getStyleRange(text.slice(rangeStart), charMetaList.slice(rangeStart))]);
    return ranges;
};

var getStyleRange = function getStyleRange(text, charMetaList) {
    var charStyle = new _immutable.OrderedSet();
    var prevCharStyle = new _immutable.OrderedSet();
    var ranges = [];
    var rangeStart = 0;
    for (var i = 0, len = text.length; i < len; i++) {
        prevCharStyle = charStyle;
        var meta = charMetaList.get(i);
        charStyle = meta ? meta.getStyle() : new _immutable.OrderedSet();
        if (i > 0 && !(0, _immutable.is)(charStyle, prevCharStyle)) {
            ranges.push([text.slice(rangeStart, i), prevCharStyle]);
            rangeStart = i;
        }
    }
    ranges.push([text.slice(rangeStart), charStyle]);
    return ranges;
};

exports.default = getEntityRanges;
module.exports = exports['default'];
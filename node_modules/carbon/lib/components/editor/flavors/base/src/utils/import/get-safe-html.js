'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _from = require('babel-runtime/core-js/array/from');

var _from2 = _interopRequireDefault(_from);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var getSafeHTML = function getSafeHTML(html) {
    if (document.implementation && document.implementation.createHTMLDocument) {
        var doc = document.implementation.createHTMLDocument('foo');
        doc.documentElement.innerHTML = html;
        // 目前编辑器不支持多层块状元素嵌套(块状元素里面只能有行内元素)
        // 所以判断一下是否存在这种情况，存在的话移除多余的块状元素
        // －－ 发现后端在处理 HTML 的时候多嵌套了一层 div
        var body = doc.getElementsByTagName('body')[0];
        var children = resolveHtml(body.firstChild);
        if (children !== body.firstChild) {
            console.warn('resolved');
            body.innerHTML = '';
            (0, _from2.default)(children).forEach(function (d) {
                return body.appendChild(d);
            });
        }
        return body;
    }
    return null;
};

/**
 * 简单的一个移除嵌套 div
 * <div><div><div>1</div><div>2</div></div></div>
 * >> <div>1</div><div>2</div>
 */
var resolveHtml = function resolveHtml(tag) {
    if (!tag) {
        return tag;
    }
    // 如果本身是一个块状元素，并且第一个子元素也是一个块状元素
    if (isBlock(tag.tagName) && tag.nextElementSibling === null && isBlock(tag.firstChild && tag.firstChild.tagName)) {
        if (tag.firstChild.nextElementSibling === null) {
            return resolveHtml(tag.firstChild);
        }
        return tag.childNodes;
    }
    return tag;
};

var blockTags = ['div', 'ol', 'ul', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'];
var isBlock = function isBlock(tag) {
    return tag ? blockTags.indexOf(tag.toLocaleLowerCase()) !== -1 : false;
};

exports.default = getSafeHTML;
module.exports = exports['default'];
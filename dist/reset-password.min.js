$(document).ready(function(){function n(){$.ajax({url:"login/account/v1/get_captcha_token",type:"POST",contentType:"application/json; charset=UTF-8",success:function(n){o=n.captcha_token,$("#captchaImg").attr("src","login/account/v1/get_captcha_image?captcha_token="+o+"&width=100&height=40"),$("#captchaImg").error(function(){captchaImgErr(o)})}}),p.val("")}function t(){if(!a())return!1;var t={purpose:"reset_password",phone:"+86 "+(u=$.trim(v.val())),Source:"web",captcha_token:o,captcha_value:$.trim(p.val())};$.ajax({url:"login/account/v1/send_verify_code",type:"POST",data:JSON.stringify(t),contentType:"application/json; charset=UTF-8",error:function(t){n();var e=t.responseJSON.message,a=t.responseJSON.status_code;getWarning(a,e)},success:function(n){function t(){0==e?($("#verifyBtn").text("发送验证码").attr("disabled",!1).removeClass("disabled"),clearInterval(a)):(e--,$("#verifyBtn").text("重新发送("+e+")").attr("disabled",!0).addClass("disabled"))}notice("我们将以短信的方式告知你验证码，请注意查收。"),console.log("手机短信验证码是",n.verify_code);var e=60,a=setInterval(function(){t()},1e3)}})}function e(){if(!r())return!1;var n={phone:"+86 "+u,source:"web",new_password:$.trim(l.val()),verify_code:s};$.ajax({url:"login/account/v1/reset_password",type:"POST",data:JSON.stringify(n),contentType:"application/json; charset=UTF-8",error:function(n){var t=n.responseJSON.message,e=n.responseJSON.status_code;getWarning(e,t)},success:function(n){$("#secStep").hide(),$("#finish").show(),i()}})}function a(){return!!/^1[3|4|5|7|8][0-9]\d{4,8}$/.test(v.val())||(warning("请正确输入手机号","#tellphone"),!1)}function c(){if(!a())return!1;s=$.trim(f.val());var n={purpose:"reset_password",phone:"+86 "+u,source:"web",verify_code:s};$.ajax({url:"login/account/v1/check_verify_code",type:"POST",data:JSON.stringify(n),contentType:"application/json; charset=UTF-8",error:function(n){var t=n.responseJSON.message,e=n.responseJSON.status_code;getWarning(e,t),s=null},success:function(n){$("#firstStep").hide(),$("#secStep").show()}})}function i(){var n=3;setInterval(function(){0==n?window.location.href="/signin":(n--,$(".finishTime").text(n))},1e3)}function r(){return/^[a-zA-Z0-9!@#$%^&*_`()-+=]{8,20}$/.test(l.val())?l.val()===d.val()||(warning("两次密码输入不一致，请确定后重新输入","#confirm"),!1):(warning("密码必须包含数字、字母、不得少于8位、不得超过20位","#password"),!1)}var o=null,s=null,u=null,p=$("#captcha input"),f=$("#verify input"),l=$("#password input"),d=$("#confirm input"),v=$("#tellphone input");n(),$("#captchaImg").click(function(){n()}),$("#verifyBtn").click(function(){t()}),$("#firstSubmitBtn").click(function(){c()}),$("#secSubmitBtn").click(function(){e()}),v.blur(function(){a()}),f.focus(function(){$(".verifytips").fadeIn(300)}),f.blur(function(){$(".verifytips").fadeOut(300)}),l.focus(function(){$(".passwordtips").fadeIn(300)}),l.blur(function(){$(".passwordtips").fadeOut(300)}),l.keyup(function(){var n=checkPasswordStrength(l.val()),t=n.strength,e=n.text;$(".process").find("p").removeClass().addClass(t),$(".strengthText").text(e)}),d.keyup(function(){d.val()!==l.val()?warning("两次密码输入不一致","#confirm"):warning("输入一致，可进行下一步","#confirm",!1,1e3)})});
$(document).ready(function(){function e(){$.ajax({url:"login/account/v1/get_captcha_token",type:"POST",contentType:"application/json; charset=UTF-8",success:function(e){c=e.captcha_token,$("#captchaImg").attr("src","login/account/v1/get_captcha_image?captcha_token="+c+"&width=100&height=40"),$("#captchaImg").error(function(){captchaImgErr(c)})}}),u.val("")}function t(e){var t=getCookie(e),n=JSON.parse(decodeURIComponent(t)),o={source:"web",tenant_id:n.tenantId};$.ajax({url:"tenant-gateway/account/signin",type:"POST",headers:{Authorization:l},data:JSON.stringify(o),contentType:"application/json; charset=UTF-8",error:function(e){window.location.href="/invite",warning(e.message)},success:function(e){setCookie("_userId",n.userId,6048e5),setCookie("_tenant_id",n.tenantId,6048e5),setCookie("_accessToken",e.body.access_token,6048e5),setCookie("_refreshToken",e.body.refresh_token,6048e5),window.location.href="/"}})}function n(){p=!0,$("#captcha").show()}function o(){return!!/^1[3|4|5|7|8][0-9]\d{4,8}$/.test(r.val())||(warning("请正确输入手机号","#tellphone"),!1)}function a(){return!!/^[a-zA-Z0-9!@#$%^&*_`()-+=]{8,20}$/.test(s.val())||(warning("密码必须包含数字、字母、不得少于8位、不得超过20位","#password"),!1)}var c=null,i=null,r=$("#tellphone input"),s=$("#password input"),u=$("#captcha input"),p=!1,l="";getCookie("_tenant_id"),getCookie("userId");r.blur(function(){o()}),$("#captchaImg").click(function(){e()}),$("#submitBtn").click(function(){if(!o())return!1;if(!a())return!1;var h=$.trim(r.val()),g={phone:"+86 "+h,password:$.trim(s.val()),source:"web"};p&&(g.captcha_token=c,g.captcha_value=$.trim(u.val()));return $.ajax({url:"login/account/v1/sign_in",type:"POST",data:JSON.stringify(g),contentType:"application/json; charset=UTF-8",error:function(t){n(),e(),i=t.responseJSON.left_times;var o=t.responseJSON.message,a=t.responseJSON.status_code;getWarning(a,o)},success:function(e){l=e.token;setCookie("_accountToken",l,432e5),setCookie("_currentPhone",h,432e5);var n="_"+h;""!==getCookie(n)?t(n):(window.location.href="/invite",warning(e.message))}}),!1})});
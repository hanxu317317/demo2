$(document).ready(function(){function t(){$.ajax({url:"login/account/v1/get_captcha_token",type:"POST",contentType:"application/json; charset=UTF-8",success:function(t){o=t.captcha_token,$("#captchaImg").attr("src","login/account/v1/get_captcha_image?captcha_token="+o+"&width=100&height=40"),$("#captchaImg").error(function(){captchaImgErr(o)})}}),f.val("")}function n(){if(!a())return!1;var n={purpose:"signup",phone:"+86 "+(l=$.trim(g.val())),Source:"web",captcha_token:o,captcha_value:$.trim(f.val())};$.ajax({url:"login/account/v1/send_verify_code",type:"POST",data:JSON.stringify(n),contentType:"application/json; charset=UTF-8",error:function(n){t();var e=n.responseJSON.message,a=n.responseJSON.status_code;getWarning(a,e)},success:function(t){function n(){0==e?($("#verifyBtn").text("发送验证码").attr("disabled",!1).removeClass("disabled"),clearInterval(a)):(e--,$("#verifyBtn").text("重新发送("+e+")").attr("disabled",!0).addClass("disabled"))}notice("我们将以短信的方式告知你验证码，请注意查收。"),console.log("手机短信验证码是",t.verify_code);var e=60,a=setInterval(function(){n()},1e3)}})}function e(){if(!r())return!1;var t={phone:"+86 "+l,source:"web",password:$.trim(d.val()),verify_code:u};$.ajax({url:"login/account/v1/sign_up",type:"POST",data:JSON.stringify(t),contentType:"application/json; charset=UTF-8",error:function(t){var n=t.responseJSON.message,e=t.responseJSON.status_code;getWarning(e,n)},success:function(t){$("#secStep").hide(),$("#finish").show(),c()}})}function a(){return!!/^1[3|4|5|7|8][0-9]\d{4,8}$/.test(g.val())||(warning("请正确输入手机号","#tellphone"),!1)}function i(){if(!a())return!1;u=$.trim(p.val());var t={purpose:"signup",phone:"+86 "+l,source:"web",verify_code:u};$.ajax({url:"login/account/v1/check_verify_code",type:"POST",data:JSON.stringify(t),contentType:"application/json; charset=UTF-8",error:function(t){var n=t.responseJSON.message,e=t.responseJSON.status_code;getWarning(e,n),u=null},success:function(t){$("#firstStep").hide(),$("#secStep").show()}})}function c(){var t=3;setInterval(function(){0==t?window.location.href="/signin":(t--,$(".finishTime").text(t))},1e3)}function r(){return/^[a-zA-Z0-9!@#$%^&*_`()-+=]{8,20}$/.test(d.val())?d.val()===v.val()||(warning("两次密码输入不一致，请确定后重新输入","#confirm"),!1):(warning("密码必须包含数字、字母、不得少于8位、不得超过20位","#password"),!1)}function s(t){var n="",e="";if(/^[0-9a-zA-Z!@#$%^&*_`()-+=]{8,20}$/.test(t))switch((null!=/[0-9]/.exec(t)?1:0)+(null!=/[a-zA-Z]/.exec(t)?1:0)+(null!=/[!@#$%^&*_`()-+=]/.exec(t)?1:0)+(t.length>12?1:0)){case 4:n="strong",e="强";break;case 3:n="normal",e="一般";break;case 2:n="weak",e="弱";break;default:n="",e=""}return{strength:n,text:e}}function a(){return!!/^1[3|4|5|7|8][0-9]\d{4,8}$/.test(g.val())||(warning("请正确输入手机号","#tellphone"),!1)}var o=null,u=null,l=null,f=$("#captcha input"),p=$("#verify input"),d=$("#password input"),v=$("#confirm input"),g=$("#tellphone input");t(),$("#captchaImg").click(function(){t()}),$("#verifyBtn").click(function(){n()}),$("#firstSubmitBtn").click(function(){i()}),$("#secSubmitBtn").click(function(){e()}),$("#tipsInput").click(function(){this.checked?$("#firstSubmitBtn").attr("disabled",!1).removeClass("disabledSubmit"):$("#firstSubmitBtn").attr("disabled",!0).addClass("disabledSubmit")}),g.blur(function(){a()}),p.focus(function(){$(".verifytips").fadeIn(300)}),p.blur(function(){$(".verifytips").fadeOut(300)}),d.focus(function(){$(".passwordtips").fadeIn(300)}),d.blur(function(){$(".passwordtips").fadeOut(300)}),d.keyup(function(){var t=s(d.val()),n=t.strength,e=t.text;$(".process").find("p").removeClass().addClass(n),$(".strengthText").text(e)}),v.keyup(function(){v.val()!==d.val()?warning("两次密码输入不一致","#confirm"):warning("输入一致，可进行下一步","#confirm",!1,1e3)})});